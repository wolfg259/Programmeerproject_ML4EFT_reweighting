# Review
### Reviewers:
- Ella van Loenen
- Gert Hakkenberg

## Probleem 1: Comments en docstrings
### 1. Wat is het tegengekomen probleem?
Beide reviewers hadden uiteindelijk toch hulp nodig met het doorgronden van de werking van de code. Tijdens beide reviews werden docstrings en comments genoemd als mogelijke factoren die de begrijpbaarheid zouden kunnen vergroten.
### 2. Hoe zou je dit beter kunnen maken?
Er zouden meer comments en uitgebreidere docstrings geschreven kunnen worden om het voor een lezer duidelijker te maken wat er binnen de code gebeurt.
### 3. Wat voor afweging maak je? 
Er zijn wat mij betreft 3 factoren die ervoor hebben gezordg dat ik de comments en docstrings zo heb geschreven als ze zijn.
1. De code is een uitwerking van meerdere papers gebaseerd op conceptueel ingewikkelde natuurkundige ideeën. Het begrijpen van deze onderliggende ideeën is onmisbaar om de werkelijke functionaliteit en de gemaakte keuzes binnen de code te kunnen doorgronden, maar het overbrengen van alle benodigde concepten in docstrings en comments is niet haalbaar. Daarom is ervoor gekozen om documentatie te richten op een puur code-technisch begrip. Ik kreeg bijvoorbeeld tijdens de reviews vragen over waarom de gekozen loss-functie 'loss_per_weight = (1 - labels) * w_e * outputs ** 2 + labels * w_e * (1 - outputs) ** 2' bevatte, maar dit is een directe implementatie van de formule $l[f] = \sum w_e(\bar{c})[f(x_e)]^2 + \sum w_e(0) [f(x_e) - 1]^2$ uit [Chen *et al.*, 2023](https://arxiv.org/pdf/2308.05704.pdf). Om een begrip van de natuurkunde die deze formule vormgeeft te vermijden, bevatten docstrings en comments dus alleen dingen als het datatype en de vorm van tensoren; dingen die begrip van de werking van de code verhogen, maar niet verdwijnen in de natuurkunde.
2. Ik werkte voor dit project samen met de originele ontwikkelaars van het ML4EFT framework aan de implementatie van reweighting. Het framework is ook na deze toevoeging nog ver van deployment-ready, en ook is het zo dat er nu gewerkt kan worden met reweighted data, maar dat er nog wel dingen moeten gebeuren om deze functionaliteit parallel aan eerdere functionaliteiten te laten werken. Hierdoor is de code zoals hij nu is waarschijnlijk behoorlijk anders dan de eindversie zal zijn, en wordt hij ook alleen door de developers gelezen. Hierom is het in overleg met andere developer besloten dat comments en docstrings voor nu vooral voor ons duidelijk moeten zijn, en dat de energie die het perfectioneren van documentatie kost beter in het werkend krijgen van de code gestopt kon worden. 
3. In tegenstelling tot de meeste projecten die we tijdens de minor ondernomen hebben kreeg ik bij dit project niet de ruimte om dingen precies te doen zoals ik ze wilde, maar was ik gebonden aan hoe eerdere ontwikkelaars dingen bepaald hebben, zowel technisch als stylistisch. Hierom ben ik in zowel de manier als de hoeveelheid documentatie dichtbij de originele intenties gebleven, die misschien van de optimale vorm verschillen, maar die nu eenmaal zo vastgelegd waren voordat ik bij het project kwam. Ook is het zo dat ik maar aan een klein deel van de totale code-base heb gewerkt. Ik heb me dus ook bij het schrijven van documentatie en bijvoorbeeld type hints beperkt tot de delen van de code waar ik iets substantieels aan veranderd heb. Daartegenover staat dat ik waar ik dat gepast achtte wél aanpassingen aan bestaande code heb gedaan, zowel stylistisch als kwalitatief, waar ik van mening was dat het geen te groot sub-project werd.

### Voorbeelden

## Probleem 2: Parallelle implementatie
### 1. Wat is het tegengekomen probleem?
Beide reviewers kwamen na overleg met mij tot de conclusie dat het makkelijker kan dan het nu is om hetzelfde framework met niet-reweighted data te gebruiken, wat uiteindelijk ook moet kunnen. Het opleveren van een volwaardige implementatie, waarin dus ergens in de settings-JSON ingesteld kan worden of er wel of geen gebruik gemaakt moet worden van reweighting.
### 2. Hoe zou je dit beter kunnen maken?
Het implementeren van deze optie was oorspronkelijk opgenomen in de planning van dit project, maar daar ben ik niet aan toegekomen. Het is echter wel nodig voordat de reweighted setup deel van de *main*-branch van ML4EFT kan worden. Hier wordt de komende tijd aan gewerkt. Als dit niet het geval was zou er ergens in de documentatie beter uitgelegd kunnen staan hoe wel of niet gebruik te maken is van reweighting.
### 3. Wat voor afweging maak je? 
Dezelfde afwegingen als bij probleem 1 speelden hier; doordat het framework nog in een vroeg stadium is werd het door de originele auteurs als belangrijker geacht dat er eerste resultaten verkregen konden worden met reweighted data dan dat alles gebruiksvriendelijk geïmplementeerd werd. Dit neemt niet weg dat het versimpelen van het gebruik van het framework een belangrijke stap in de toekomst is.

## Probleem 3: Checks, tests en tussentijdse output
### 1. Wat is het tegengekomen probleem?
Er zijn niet alleen geen tests aanwezig voor het bestaande framework, maar ook tijdens het runnen van het trainingsscript zijn er nauwelijks tussentijdse "checks" die iets vertellen over hoe het trainen verloopt, naast het printen van de loss.
### 2. Hoe zou je dit beter kunnen maken?
Er zou een testsuite geschreven kunnen worden voor (delen van) het framework, en er zou gekeken kunnen worden naar andere plekken in het proces waarbij iets van validerende output geprint of opgeslagen kan worden.
### 3. Wat voor afweging maak je? 
Het ML4EFT framework is complex en best groot, ondanks dat het nog niet af is. Het schrijven van een testsuite voor alle code zou een programmeerproject op zich kunnen zijn, en daarbovenop is alle code die voordat er over reweighting nagedacht werd al uitvoerig op andere manieren getest en ge-*benchmarked* (zie bijvoorbeeld het [originele paper waarin ML4EFT gepresenteerd werd (Ambrosio *et al.*, 2023)](https://link.springer.com/content/pdf/10.1007/JHEP03(2023)033.pdf)). Hierom is er gekozen om zoals ook voor eerdere problemen geldt eerst reweighting werkend te krijgen, en daarna kan er naar verdere tests en andere aspecten van een volwaardige package gekeken worden. Anderzijds is het zo dat ML4EFT niet alleen een ml-framework is, wat het invoegen van tests tussen het trainen en het opleveren van een getraind model al bemoeilijkt, maar ook nog een sterk theoretisch gebonden en situatie-afhankelijk concept probeert te implementeren. Hierdoor zijn er voor zover ik kon bedenken weinig tot geen concrete outputs die er geprint of anderzijds zichtbaar gemaakt konden worden om te bevestigen of alles verloopt zoals gehoopt, naast het printen van training en validation loss per training epoch.
